import u from"fs";import s from"path";import{cwd as Z}from"process";import d from"fs";import y from"path";var F=t=>{let r=/\/\*\*(?:(.|\r|\n)*?@doc[A-Z](?:.|\r|\n)*?)\*\//gm,e="",o;for(;o=r.exec(t);)e?e=e.concat(`\r
`,o[0]):e=o[0];return e};var T=t=>t.split(/\r?\n/).reduce((e,o)=>(o.includes("@doc")?e.push(o):o.includes("/**")||o.includes("*/")||(e[e.length-1]+=` ${o.replace("*","").trim()}`),e),[]);import N from"prettier";import R from"fs";var A={jsxBracketSameLine:!1,semi:!0,tabWidth:2,singleQuote:!0,printWidth:120,useTabs:!1,bracketSpacing:!0},g=(t,r)=>{let e=N.format(r,{...A,filepath:t});R.writeFileSync(t,e,"utf8")};var M=/(\{([^\}]+)\})*/.source,k=/(\(([^\)]*)\))*/.source,B=/([^\s]+)/.source,I=/\[([^\s\]=]*)(=([^\]]+))?\]/.source,P=/(?:-\s+([^\*\r\n]*))?/.source,W=/\s+/.source,D=/\s*/.source,J=/@doc(\w+)/.source,V=new RegExp(`${J}${W}${M}${D}${k}${D}(${I}|${B})${D}${P}`);function L(t){let[,r,,e,,o,,n,,i,f,c]=t,a=o==null?void 0:o.split(",").map(h=>{let[p,G]=h.split("=");return{name:p,type:G}});return{tag:r,type:e,params:a,name:n||f,defaultValue:i,description:c}}var j=t=>{let r=t.match(V);return L(r)},U=/@doc(\w+)\s+([\w- ]+)/;function z(t){let[,r,e]=t;return{[r.toLowerCase()]:e}}var O=t=>{let r=t.match(U);return z(r)};function Q(t){let r=T(t),e={};return r.forEach(o=>{if(o.includes("@docFile")||o.includes("@docDescription")){let n=O(o);e={...e,...n}}else{let n=j(o);if(n.tag){let i=n.tag.toLowerCase();delete n.tag,e[i]?e[i].push(n):e[i]=[n]}}}),e}var $=(t,r)=>{try{let e=d.readFileSync(t,"utf-8"),o=F(e);if(!o)return;let n=Q(o),i=y.basename(t,y.extname(t)),f={name:i,...n},c=`import type {FileDetails} from "@/types/lib";
 const fileDetails: FileDetails = ${JSON.stringify(f)}; 
 export default fileDetails;`,a=r;return d.existsSync(y.dirname(a))||d.mkdirSync(y.dirname(a),{recursive:!0}),d.writeFileSync(a,c),g(a,c),console.log(`Generated file for ${i}.`),n.file||""}catch(e){console.error(e)}};var S=Z(),q=(t,r)=>{let e=t.replace(r,"");return s.parse(e).dir.split("/").reduce((n,i)=>n+=i||"","")},H=t=>({name:s.basename(t),type:"folder",children:[]}),K=(t,r,e)=>({name:s.basename(t,s.extname(t)),type:"file",fileType:e,extension:s.extname(t),prefix:q(t,r)}),w=(t,r,e,o)=>{let n=H(t);try{u.readdirSync(t).forEach(f=>{let c=s.join(t,f),a=u.statSync(c);if(a.isDirectory())w(c,n,e,o);else if(a.isFile()){let l=K(c,e),h=s.join(S,o.outputDir,"src","generated",`${l.prefix}${l.name}.ts`),p=$(c,h);typeof p=="string"&&(p?l.fileType=p:l.fileType=l.extension===".vue"?"Component":"Module",n.children.push(l))}}),Array.isArray(r)?r.push(n):r.children.push(n)}catch(i){console.error("Unable to read directory: "+i);return}},X=(t,r)=>{let e=[];C(t,e);let o={...t,children:v(t)},n=s.join(S,r,"src","generated","index.ts"),i=`const files = ${JSON.stringify(o)}; 
 export default files; 
 export const searchItems = ${JSON.stringify(e)};`;u.existsSync(s.dirname(n))||u.mkdirSync(s.dirname(n),{recursive:!0});try{u.writeFileSync(n,i),g(n,i)}catch(f){console.error(f)}};function C(t,r){return t.children.forEach(e=>{e.type==="folder"?C(e,r):r.push({name:e.name,view:"FileView",prefix:e.prefix})})}function v(t){return t.children.reduce((r,e)=>(e.type==="folder"?e.children.length>0&&(r.push(e),e.children=v(e)):r.push(e),r),[])}var E=t=>{let r=s.join(S,t.sourceDir),e=[];w(r,e,r,t),e.length&&X(e[0],t.outputDir)};import{cosmiconfig as Y}from"cosmiconfig";var _=Y("docs"),ee={sourceDir:"template/src/components",outputDir:"docs"},te=async()=>{let t=await _.search("docs.config");return t&&t.config?t.config:{...ee}},x=te;import oe from"path";import m from"fs";import re from"path";function b(t){m.existsSync(t)&&m.readdirSync(t).forEach(r=>{let e=re.join(t,r);m.lstatSync(e).isDirectory()?(b(e),m.rmdirSync(e)):m.unlinkSync(e)})}(async()=>{let t=await x();try{let r=oe.join(t.outputDir,"src","generated");b(r),console.log(`Generated data deleted from ${r}`)}catch(r){console.error(`Unable to delete generated data: ${r}`)}})();(async()=>{let t=await x();E(t)})();
